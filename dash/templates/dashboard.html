<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="refresh" content="60"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard PCP - GDB Metalmachinery</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #121212; color: white; } /* Fundo escuro para a TV não cansar a vista */
        .card-maquina { background-color: #1e1e1e; border: 1px solid #333; height: 100%; }
        .progress { height: 30px; font-size: 1.1rem; font-weight: bold; }
        .label-maquina { color: #aaa; font-size: 0.8rem; text-transform: uppercase; }
        .valor-maquina { font-size: 1.2rem; color: #fff; }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <h1 class="text-center mb-4">Status de Entrega - GDB / China</h1>
        
        <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4">
            {% for m in maquinas %}
            <div class="col">
                <div class="card card-maquina shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h5 class="card-title mb-0 text-info">{{ m.matricula_br }}</h5>
                            <span class="badge {% if m.tipo == 'LASER' %}bg-danger{% else %}bg-primary{% endif %}">
                                {{ m.tipo }}
                            </span>
                        </div>
                        
                        <div class="mb-3">
                            <div class="label-maquina">Cliente</div>
                            <div class="valor-maquina text-truncate">{{ m.cliente }}</div>
                        </div>

                        <div class="label-maquina mb-1">Status da Produção ({{ m.apontamento.total_geral|floatformat:1 }}%)</div>
                        <div class="progress mb-3">
                            <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" 
                                 role="progressbar" 
                                 style="width: {{ m.apontamento.total_geral }}%">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-6">
                                <div class="label-maquina">Chegada BR</div>
                                <div class="valor-maquina text-warning">
                                    {{ m.data_chegada_br|date:"d/m/Y"|default:"Em trânsito" }}
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="label-maquina">Entrega Cliente</div>
                                <div class="valor-maquina">{{ m.data_entrega|date:"d/m/Y" }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12 text-center mt-5">
                <h3>Nenhuma máquina cadastrada para exibição.</h3>
            </div>
            {% endfor %}
        </div>
    </div>
</body>
</html>